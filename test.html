<!DOCTYPE html>
<html>
<head>
    <title>LyX Hotkey Plugin Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 200px; margin: 10px 0; }
        button { margin: 5px; padding: 10px; }
        .status { margin: 10px 0; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>LyX Hotkey Plugin Test Page</h1>
    
    <div class="status" id="status">
        Loading...
    </div>
    
    <h2>Test Area</h2>
    <textarea placeholder="Try using Alt+M+F for \frac{}{}, Alt+M+S for \sqrt{}, etc."></textarea>
    
    <div>
        <button onclick="testPlugin()">Test Plugin Status</button>
        <button onclick="loadSampleBindings()">Load Sample Bindings</button>
        <button onclick="testInsertion()">Test Insertion</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        function logResult(message) {
            const results = document.getElementById('results');
            results.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }
        
        async function testPlugin() {
            try {
                if (window.lyxHotkeyPlugin) {
                    const status = window.lyxHotkeyPlugin.getStatus();
                    logResult('Plugin Status: ' + JSON.stringify(status, null, 2));
                    updateStatus('Plugin found and active: ' + status.active + ', Bindings: ' + status.bindingCount);
                } else {
                    logResult('Plugin not found');
                    updateStatus('Plugin not found');
                }
            } catch (error) {
                logResult('Error: ' + error.message);
                updateStatus('Error testing plugin');
            }
        }
        
        async function loadSampleBindings() {
            try {
                const sampleBindings = `Format 4

\\bind "M-m f"		"math-insert \\frac"
\\bind "M-m s"		"math-insert \\sqrt"
\\bind "M-m x"		"math-subscript"
\\bind "M-m e"		"math-superscript"
\\bind "M-m g a"		"math-insert \\alpha"
\\bind "M-m g b"		"math-insert \\beta"`;
                
                if (window.lyxHotkeyPlugin) {
                    window.lyxHotkeyPlugin.loadBindings(sampleBindings);
                    logResult('Sample bindings loaded');
                    setTimeout(testPlugin, 500); // Test after loading
                } else {
                    logResult('Plugin not available');
                }
            } catch (error) {
                logResult('Error loading bindings: ' + error.message);
            }
        }
        
        async function testInsertion() {
            try {
                const textarea = document.querySelector('textarea');
                if (window.LyXInserter) {
                    const success = window.LyXInserter.insertText('\\frac{}{}', textarea);
                    logResult('Insertion test result: ' + success);
                } else {
                    logResult('LyXInserter not available');
                }
            } catch (error) {
                logResult('Error testing insertion: ' + error.message);
            }
        }
        
        // Initial status check
        setTimeout(() => {
            testPlugin();
        }, 1000);
    </script>
</body>
</html>